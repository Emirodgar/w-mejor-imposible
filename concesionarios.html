<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porsche - Directorio de Centros Oficiales</title>
	<link rel="icon" type="image/png" sizes="32x32" href="img/favicon.png">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <style>
        :root {
            --porsche-red: #B12B28; --porsche-gold: #E3AB37; --porsche-black: #000000;
            --porsche-grey: #464C47; --light-bg: #f4f5f7; --light-card-bg: #ffffff;
            --light-text: #172b4d; --dark-bg: #1d2125; --dark-card-bg: #282c34;
            --dark-text: #e1e1e1;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; transition: background-color 0.3s, color 0.3s; }
        .theme-light { background-color: var(--light-bg ); color: var(--light-text); }
        .theme-dark { background-color: var(--dark-bg); color: var(--dark-text); }
        .dashboard-container { padding: 20px; max-width: 1400px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .header-title { font-size: 24px; font-weight: 600; display: flex; align-items: center; }
        .header-title img { height: 40px; margin-right: 15px; }
        .header-controls button { background: none; border: 1px solid var(--porsche-grey); color: inherit; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .card { border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); transition: background-color 0.3s, color 0.3s; margin-bottom: 20px; }
        .theme-light .card { background-color: var(--light-card-bg); }
        .theme-dark .card { background-color: var(--dark-card-bg); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        
        .filter-container { margin-bottom: 20px; }
        #search-filter {
            width: 100%; padding: 12px; border-radius: 6px; border: 1px solid var(--porsche-grey);
            background-color: inherit; color: inherit; font-size: 16px; box-sizing: border-box;
        }
        .directory-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        
        #map { height: 600px; border-radius: 8px; }
        .dealer-list-container { height: 600px; overflow-y: auto; padding-right: 10px; }

        .dealer-card {
            display: flex; flex-direction: column; padding: 15px;
            border: 1px solid; border-radius: 8px; margin-bottom: 15px;
            transition: background-color 0.3s ease-out, transform 0.2s ease;
        }
        .theme-light .dealer-card { border-color: #e0e0e0; }
        .theme-dark .dealer-card { border-color: #444; }

        .dealer-card.highlight {
            background-color: var(--porsche-gold);
            color: var(--porsche-black);
            transform: scale(1.02);
        }
        .theme-dark .dealer-card.highlight { color: var(--porsche-black) !important; }

        .dealer-card h3 { margin: 0 0 10px 0; font-size: 18px; color: var(--porsche-red); }
        .dealer-card.highlight h3 { color: var(--porsche-black); }
        .dealer-card p { margin: 2px 0; font-size: 14px; }
        .dealer-rating { display: flex; align-items: center; margin-top: 10px; }
        .dealer-rating .stars { color: var(--porsche-gold); font-size: 20px; }
        .dealer-card.highlight .stars { color: var(--porsche-red); }
        .dealer-rating .score { margin-left: 10px; font-weight: bold; }
        .dealer-actions { margin-top: 15px; }
        .dealer-actions a {
            text-decoration: none; color: inherit; padding: 8px 15px;
            border-radius: 6px; border: 1px solid var(--porsche-grey); margin-right: 10px; font-size: 14px;
        }
        .dealer-actions a:hover { background-color: var(--porsche-grey); color: white; }

        @media (max-width: 992px) {
            .directory-layout { grid-template-columns: 1fr; }
            #map { height: 400px; }
        }
    </style>
</head>
<body class="theme-dark">

    <div class="dashboard-container">
        <header class="header">
            <div class="header-title">
                <img src="img/logo.png" alt="Porsche Crest">
                <span>Directorio de Centros Porsche Oficiales en España</span>
            </div>
            <div class="header-controls">
                <button id="theme-toggle">Cambiar a Tema Claro</button>
            </div>
        </header>

        <main>
            <div class="card">
                <div class="filter-container">
                    <input type="text" id="search-filter" placeholder="🔎 Buscar por nombre, ciudad o dirección...">
                </div>
                <div class="directory-layout">
                    <div id="map" class="map-container">
                        </div>
                    <div id="dealer-list" class="dealer-list-container">
                        </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    const dealerData = [
        { id: 'zaragoza', name: 'Centro Porsche Zaragoza', address: 'Ctra. de Logroño, km 8,5. 50011, Zaragoza', rating: 4.9, phone: '976324110', lat: 41.6586, lng: -1.0033 },
        { id: 'sevilla', name: 'Centro Porsche Sevilla', address: 'Avda. Ruta de la Plata, 3. 41900, Camas (Sevilla)', rating: 4.2, phone: '954999449', lat: 37.3995, lng: -6.0406 },
        { id: 'acoruna', name: 'Centro Porsche A Coruña', address: 'N-VI, km. 589. 15172, Oleiros (A Coruña)', rating: 4.5, phone: '981637111', lat: 43.3298, lng: -8.3846 },
        { id: 'valencia', name: 'Centro Porsche Valencia', address: 'Avda. Comarques Del País Valencià, 4-6. 46930, Quart De Poblet (Valencia)', rating: 4.7, phone: '963168100', lat: 39.4851, lng: -0.4578 },
        { id: 'bilbao', name: 'Centro Porsche Bilbao', address: 'Carretera Bilbao-San Sebastián. 48960, Galdakao (Vizcaya)', rating: 4.7, phone: '944570101', lat: 43.2519, lng: -2.8524 },
        { id: 'murcia', name: 'Centro Porsche Murcia', address: 'Ctra. de Alicante, 168. 30007, Murcia', rating: 4.7, phone: '968307799', lat: 38.0068, lng: -1.1095 },
        { id: 'valladolid', name: 'Centro Porsche Valladolid', address: 'Avda. de Burgos, 54. 47009, Valladolid', rating: 4.7, phone: '983048080', lat: 41.6601, lng: -4.7161 },
        { id: 'madrid-oeste', name: 'Centro Porsche Madrid Oeste', address: 'C/ Ciruela, 5. 28222, Majadahonda (Madrid)', rating: 4.6, phone: '916405800', lat: 40.4735, lng: -3.8550 },
        { id: 'marbella', name: 'Centro Porsche Marbella', address: 'C/ Pirita, s/n, esq. C/ Níquel. Polígono Industrial Las Albarizas. 29603, Marbella (Málaga)', rating: 4.6, phone: '952776171', lat: 36.5126, lng: -4.9015 },
        { id: 'alicante', name: 'Centro Porsche Alicante', address: 'Ctra. de Ocaña, 52. 03007, Alicante', rating: 4.6, phone: '965100155', lat: 38.3582, lng: -0.5098 },
        { id: 'vigo', name: 'Centro Porsche Vigo', address: 'Ctra. de Madrid, 152. 36318, Vigo (Pontevedra)', rating: 4.6, phone: '986251388', lat: 42.1979, lng: -8.6738 },
        { id: 'madrid-norte', name: 'Centro Porsche Madrid Norte', address: 'Avda. de Burgos, 87. 28050, Madrid', rating: 4.5, phone: '914535300', lat: 40.4746, lng: -3.6888 },
        { id: 'baleares', name: 'Centro Porsche Baleares', address: 'Camí Dels Reis, 166. 07011, Palma de Mallorca', rating: 4.5, phone: '971432222', lat: 39.5935, lng: 2.6517 },
        { id: 'girona', name: 'Centro Porsche Girona', address: 'C/ Pla de la Seva, 15. 17458, Fornells de la Selva (Girona)', rating: 4.5, phone: '972406060', lat: 41.9365, lng: 2.8130 },
        { id: 'pamplona', name: 'Centro Porsche Pamplona', address: 'Polígono Industrial Talluntxe I, C/A 38-40. 31110, Noáin (Navarra)', rating: 4.5, phone: '948316011', lat: 42.7845, lng: -1.6245 },
        { id: 'barcelona', name: 'Centro Porsche Barcelona', address: 'C/ de la Botànica, 102. 08908, L\'Hospitalet de Llobregat (Barcelona)', rating: 4.4, phone: '932896800', lat: 41.3571, lng: 2.1150 },
        { id: 'granada', name: 'Centro Porsche Granada', address: 'C/ Granada, 15. Polígono Industrial El Fresno. 18102, Chauchina (Granada)', rating: 4.4, phone: '958011911', lat: 37.1950, lng: -3.7712 },
        { id: 'asturias', name: 'Centro Porsche Asturias', address: 'PE-A, Vía II, 4. 33428, Llanera (Asturias)', rating: 4.4, phone: '985793511', lat: 43.4310, lng: -5.8360 },
        { id: 'laspalmas', name: 'Centro Porsche Las Palmas', address: 'C/ Diego Vega Sarmiento, 15. 35014, Las Palmas de Gran Canaria', rating: 4.4, phone: '928488400', lat: 28.1065, lng: -15.4418 },
        { id: 'santander', name: 'Centro Porsche Santander', address: 'Avda. de la Sta. Cruz, s/n. 39100, Santa Cruz de Bezana (Cantabria)', rating: 4.4, phone: '942585011', lat: 43.4357, lng: -3.8920 },
        { id: 'santcugat', name: 'Centro Porsche Sant Cugat', address: 'C/ del Prat de la Riba, 20. 08173, Sant Cugat del Vallès (Barcelona)', rating: 4.3, phone: '935830520', lat: 41.4682, lng: 2.0620 }
    ];

    document.addEventListener('DOMContentLoaded', ( ) => {
        let map;

        function initializePage() {
            initializeMap();
            renderDealerList(dealerData);
            setupEventListeners();
        }

        function initializeMap() {
            map = L.map('map').setView([40.416775, -3.703790], 6);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // --- NUEVO: Definición del icono rojo ---
            const redIcon = new L.Icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });

            dealerData.forEach(dealer => {
                // --- MODIFICADO: Añadimos la opción 'icon' al crear el marcador ---
                const marker = L.marker([dealer.lat, dealer.lng], { icon: redIcon }).addTo(map);
                marker.bindTooltip(dealer.name);

                marker.on('click', () => {
                    const cardElement = document.getElementById(`dealer-${dealer.id}`);
                    if (cardElement) {
                        const listContainer = document.getElementById('dealer-list');
                        listContainer.scrollTo({
                            top: cardElement.offsetTop - listContainer.offsetTop,
                            behavior: 'smooth'
                        });

                        document.querySelectorAll('.dealer-card.highlight').forEach(el => el.classList.remove('highlight'));
                        
                        cardElement.classList.add('highlight');
                        setTimeout(() => {
                            cardElement.classList.remove('highlight');
                        }, 2500);
                    }
                });
            });
        }

        function renderDealerList(dealersToRender) {
            const listContainer = document.getElementById('dealer-list');
            
            if (dealersToRender.length === 0) {
                listContainer.innerHTML = `<p style="text-align:center; padding: 20px;">No se encontraron concesionarios.</p>`;
                return;
            }
            
            listContainer.innerHTML = dealersToRender.sort((a, b) => b.rating - a.rating).map(dealer => {
                // --- MODIFICADO: La URL ahora busca el nombre del negocio ---
                const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(dealer.name + ', ' + dealer.address)}`;
                const phoneUrl = `tel:${dealer.phone}`;
                
                let stars = '★'.repeat(Math.floor(dealer.rating));
                if (dealer.rating % 1 >= 0.5) stars += '½';
                stars += '☆'.repeat(5 - stars.length);

                return `
                    <div class="dealer-card" id="dealer-${dealer.id}">
                        <h3>${dealer.name}</h3>
                        <p>${dealer.address}</p>
                        <div class="dealer-rating">
                            <span class="stars">${stars}</span>
                            <span class="score">${dealer.rating.toFixed(1)}</span>
                        </div>
                        <div class="dealer-actions">
                            <a href="${googleMapsUrl}" target="_blank">Ver en Mapa</a>
                            <a href="${phoneUrl}">Llamar</a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function setupEventListeners() {
            document.getElementById('theme-toggle').addEventListener('click', () => {
                document.body.classList.toggle('theme-light');
                document.body.classList.toggle('theme-dark');
                document.getElementById('theme-toggle').textContent = document.body.classList.contains('theme-dark') ? 'Cambiar a Tema Claro' : 'Cambiar a Tema Oscuro';
            });
            
            const searchInput = document.getElementById('search-filter');
            searchInput.addEventListener('input', (event) => {
                const searchTerm = event.target.value.toLowerCase().trim();
                const filteredDealers = dealerData.filter(dealer => 
                    dealer.name.toLowerCase().includes(searchTerm) || 
                    dealer.address.toLowerCase().includes(searchTerm)
                );
                renderDealerList(filteredDealers);
            });
        }

        initializePage();
    });
    </script>
</body>
</html>